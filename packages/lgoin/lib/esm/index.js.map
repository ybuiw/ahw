{"version":3,"sources":["../../src/index.tsx"],"names":["React","useState","useCallback","useEffect","ConfigProvider","Form","Input","Button","message","Captcha","Code","props","isSend","setIsSend","codenum","setCodenum","classs","setClasss","_code","Number","count","_timer","setInterval","n","clearInterval","onCode","is","msg","Error","success","error","err","console","Login","code","setCode","useForm","form","_source","source","_sources","split","codeChange","captcha","coderequired","rule","value","Promise","reject","toLowerCase","resolve","mobilerequired","ismobile","getCode","callback","validateFields","then","res","boolean","catch","style","paddingTop","title","autoComplete","values","onLogin","isSource","required","validator","marginRight","width","marginTop","arr","str","includes","mobile","pattern","test"],"mappings":"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","sourcesContent":["import React, { useState, useCallback, useEffect } from 'react';\r\nimport { ConfigProvider, Form, Input, Button, message } from 'antd';\r\nimport Captcha from 'react-captcha-code';\r\nimport './index.css';\r\nimport { AntdTreeNodeAttribute } from 'antd/lib/tree';\r\n\r\nexport type source = 'username/code' | 'username' | 'mobile'\r\n\r\nexport interface LoginFace {\r\n  style?: React.CSSProperties,\r\n  /**\r\n   * 登录页log标题，可以是图片\r\n  */\r\n  title?: React.ReactNode | string,\r\n  /**\r\n   * 默认 username | code\r\n   * @ username | code  账号，密码，验证码\r\n   * @ username 账号，密码\r\n   * @ mobile 手机号，验证码\r\n  */\r\n  source?: source,\r\n  /**\r\n   * source 为 mobile 的时候设置倒计时长\r\n  */\r\n  count?: number,\r\n  /**\r\n   * 登陆默认值，只有初始化以及重置时生效\r\n   * @ username  账号\r\n   * @ mobile 手机号\r\n   * @ password 密码\r\n  */\r\n  values?: any,\r\n  onLogin?: (values: any) => void,\r\n  onCode?: any,\r\n}\r\n\r\n\r\n\r\nconst Code = (props: LoginFace) => {\r\n  const [isSend, setIsSend] = useState<boolean>(false)\r\n  const [codenum, setCodenum] = useState<number>(0);\r\n  const [classs, setClasss] = useState<string>('');\r\n  const _code: number = Number(props.count) || 60;\r\n\r\n  useEffect(() => {\r\n    let _timer: any = null;\r\n    if (isSend && codenum !== 0) {\r\n      _timer = setInterval(() => {\r\n        setCodenum(n => {\r\n          if (n === 1) {\r\n            setClasss('');\r\n            setIsSend(false);\r\n            clearInterval(_timer)\r\n          }\r\n          return n - 1\r\n        });\r\n      }, 1000)\r\n    }\r\n    return () => {\r\n      clearInterval(_timer)\r\n    };\r\n  }, [isSend, codenum])\r\n\r\n  const onCode = () => {\r\n    props.onCode((is: boolean, msg: string) => {\r\n      try {\r\n        if (typeof is !== 'boolean') {\r\n          throw new Error('发送验证码onCode事件callback回调第一个字符串必须为 boolean');\r\n        } else {\r\n          setClasss('disabled');\r\n          if (is) {\r\n            message.success('验证码发送成功', 1.5);\r\n            setCodenum(_code);\r\n            setIsSend(true);\r\n          } else {\r\n            message.error(msg ? msg : '发送失败', 1.5);\r\n            setClasss('');\r\n          }\r\n        }\r\n      } catch (err) {\r\n        console.error(err)\r\n      }\r\n    })\r\n  }\r\n\r\n  return (\r\n    <div className={`ahwCode ${classs}`} onClick={onCode}>\r\n      {isSend ? `${codenum}s 后重新获取` : '获取验证码'}\r\n    </div>\r\n  )\r\n}\r\n\r\nconst Login = (props: LoginFace) => {\r\n  const [code, setCode] = useState<string>('');\r\n  const [form] = Form.useForm();\r\n\r\n  const _source: any = props.source || 'username/code';\r\n  const _sources = _source.split('/');\r\n\r\n  const codeChange = useCallback((captcha: string) => {\r\n    setCode(captcha)\r\n  }, []);\r\n  \r\n  const coderequired = (rule: any, value: string) => {\r\n    if (!value) {\r\n      return Promise.reject('请输入验证码');\r\n    } else {\r\n      if (code.toLowerCase() !== value.toLowerCase()) {\r\n        return Promise.reject('验证码输入错误');\r\n      }\r\n    }\r\n    return Promise.resolve();\r\n  }\r\n\r\n  // 验证手机号码\r\n  const mobilerequired = (rule: any, value: string) => {\r\n    if (!value) {\r\n      return Promise.reject('请输入手机号');\r\n    } else {\r\n      if (!ismobile(value)) {\r\n        return Promise.reject('手机号输入错误');\r\n      }\r\n    }\r\n    return Promise.resolve();\r\n  }\r\n\r\n  const getCode = (callback: any) => {\r\n    form.validateFields(['mobile']).then(res => {\r\n      props.onCode((boolean: boolean, msg?:string) => callback(boolean, msg))\r\n    }).catch(() => {})\r\n  }\r\n\r\n  return (\r\n    <div className=\"loginPage\" style={props.style}>\r\n      <div className=\"continar\">\r\n        <div className=\"form\">\r\n          <div className=\"title\" style={{\r\n            paddingTop: typeof props.title === 'string' ? '30px' : '20'\r\n          }}>{props.title}</div>\r\n          <ConfigProvider input={{\r\n            autoComplete: 'off' \r\n          }}>\r\n            <Form\r\n              form={form}\r\n              size=\"large\"\r\n              initialValues={props.values}\r\n              onFinish={props.onLogin}\r\n            >\r\n              {isSource(_sources, 'username') &&\r\n                <>\r\n                  <Form.Item\r\n                    name=\"username\"\r\n                    rules={[{ required: true, message: '请输入账号' }]}\r\n                  >\r\n                    <Input placeholder=\"账号\" />\r\n                  </Form.Item>\r\n                  <Form.Item\r\n                    name=\"password\"\r\n                    rules={[{ required: true, message: '请输入密码' }]}\r\n                  >\r\n                    <Input.Password placeholder=\"密码\" />\r\n                  </Form.Item>\r\n                </>\r\n              }\r\n              {isSource(_sources, 'mobile') &&\r\n                <>\r\n                  <Form.Item\r\n                    name=\"mobile\"\r\n                    rules={[{ validator: mobilerequired }]}\r\n                  >\r\n                    <Input type=\"number\" maxLength={11} placeholder=\"手机号\" />\r\n                  </Form.Item>\r\n                  <div className=\"display\">\r\n                    <div className=\"col\" style={{marginRight: '10px'}}>\r\n                      <Form.Item\r\n                        name=\"code\"\r\n                        rules={[{ required: true, message: '请输入验证码' }]}\r\n                      >\r\n                        <Input placeholder=\"验证码\" />\r\n                      </Form.Item>\r\n                    </div>\r\n                    <Code count={props.count} onCode={getCode} />\r\n                  </div>\r\n                </>\r\n              }\r\n              {isSource(_sources, 'username') && isSource(_sources, 'code') &&\r\n                <div className=\"display\">\r\n                  <div className=\"col\">\r\n                    <Form.Item\r\n                      name=\"code\"\r\n                      rules={[{ validator: coderequired }]}\r\n                    >\r\n                      <Input placeholder=\"验证码\" />\r\n                    </Form.Item>\r\n                  </div>\r\n                  <div>\r\n                    <Captcha charNum={4} onChange={codeChange} />\r\n                  </div>\r\n                </div>\r\n              }\r\n              <Form.Item>\r\n                <Button type=\"primary\" htmlType=\"submit\" style={{width: '100%', marginTop: '10px'}}>登录</Button>\r\n              </Form.Item>\r\n            </Form>\r\n          </ConfigProvider>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Login;\r\n\r\nfunction isSource(arr: any[string], str: string) {\r\n  return arr.includes(str);\r\n}\r\n\r\nfunction ismobile(mobile: number | string) {\r\n  var pattern: any = /^1[03456789]\\d{9}$/;\r\n  return pattern.test(mobile)\r\n}"]}